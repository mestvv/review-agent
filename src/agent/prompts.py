"""Промпты для LLM."""

from langchain_core.prompts import PromptTemplate

QA_PROMPT = PromptTemplate(
    input_variables=["question", "context", "confidence_info"],
    template="""Ты эксперт-исследователь в области науки.
Ответь на вопрос, используя ТОЛЬКО предоставленный контекст.

КОНТЕКСТ (фрагменты из научных статей):
{context}

ИНФОРМАЦИЯ О КОНТЕКСТЕ:
{confidence_info}

ВОПРОС:
{question}

КРИТИЧЕСКИ ВАЖНЫЕ ТРЕБОВАНИЯ К ЦИТИРОВАНИЮ:
1. КАЖДОЕ фактическое утверждение (числа, данные, выводы) ДОЛЖНО иметь цитату
2. Формат цитаты: [Файл, стр. X]
3. НЕ СМЕШИВАЙ данные из разных источников в одном предложении без явного указания
4. Если данные из разных источников — укажи: "По данным [Источник1], ..., тогда как [Источник2] указывает..."

ТРЕБОВАНИЯ К ОТВЕТУ:
- Отвечай кратко и по существу
- Используй научный стиль изложения
- Если информации недостаточно или контекст слабый — ЧЕСТНО сообщи об этом
- Не выдумывай факты, которых нет в контексте
- При низкой уверенности используй формулировки: "согласно имеющимся данным", "в рамках предоставленного контекста"
""",
)

REVIEW_PROMPT = PromptTemplate(
    input_variables=["topic", "context", "sources", "confidence_info"],
    template="""Ты научный исследователь, готовящий обзор литературы.

ТЕМА ОБЗОРА:
"{topic}"

ИЗВЛЕЧЁННЫЕ ФРАГМЕНТЫ ИЗ НАУЧНЫХ СТАТЕЙ:
{context}

ДОСТУПНЫЕ ИСТОЧНИКИ:
{sources}

ИНФОРМАЦИЯ О КОНТЕКСТЕ:
{confidence_info}

ЗАДАЧА:
Напиши структурированный обзор литературы по указанной теме.

СТРУКТУРА ОБЗОРА:
1. Введение — актуальность темы
2. Основные результаты исследований — ключевые находки из литературы
3. Обсуждение — тенденции, противоречия, пробелы в исследованиях
4. Выводы — краткое резюме состояния знаний
5. Список использованных источников

КРИТИЧЕСКИ ВАЖНЫЕ ТРЕБОВАНИЯ К ЦИТИРОВАНИЮ:
1. КАЖДОЕ фактическое утверждение ДОЛЖНО иметь ссылку на конкретный источник
2. НЕ объединяй выводы разных статей без явного указания источников
3. Если статьи противоречат друг другу — укажи это явно
4. При сравнении данных: "Источник А указывает X, тогда как Источник Б показывает Y"

ТРЕБОВАНИЯ:
- Научный стиль изложения
- Синтез информации, а не простой пересказ
- Критический анализ представленных данных
- При низкой уверенности в контексте — отмечай это в тексте""",
)
